<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Al-Kasav Smart Irrigation System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#e8f5e9;margin:0;padding:10px;}
.card{background:white;padding:15px;border-radius:10px;margin-bottom:10px;box-shadow:0 0 5px #aaa;}
h2{color:#2e7d32;}
.big{font-size:20px;font-weight:bold;}
.green{color:#2e7d32;}
.red{color:red;}
</style>
</head>
<body>

<div class="card">
<h2>ЁЯМ╛ Al-Kasav Smart Irrigation System</h2>
ржХрзГрж╖ржХрзЗрж░ ржирж╛ржо: <input id="farmer" value="" style="width:100%">
</div>

<div class="card" id="location">ЁЯУН рж▓рзЛржХрзЗрж╢ржи ржзрж░ржЫрж┐...</div>
<div class="card" id="weather">ЁЯМж ржЖржмрж╣рж╛ржУрзЯрж╛ рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</div>
<div class="card" id="water"></div>
<div class="card" id="decision"></div>
<div class="card" id="plan"></div>

<script>
navigator.geolocation.getCurrentPosition(pos=>{
 let lat=pos.coords.latitude;
 let lon=pos.coords.longitude;
 document.getElementById("location").innerHTML=
 "ЁЯУН Latitude: "+lat.toFixed(2)+" , Longitude: "+lon.toFixed(2);

 fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,precipitation&daily=temperature_2m_max,precipitation_sum&timezone=auto`)
 .then(r=>r.json()).then(d=>{

 let T=d.current.temperature_2m;
 let H=d.current.relative_humidity_2m;
 let W=d.current.wind_speed_10m;
 let R=d.current.precipitation;

 // Evaporation
 let E=(T*W)/H;
 // Condensation
 let C=(H/100)*(25/T);

 let net=E-C-R;
 if(net<0) net=0;

 let soil=100 - net*10;
 if(soil<0) soil=0;
 if(soil>100) soil=100;

 document.getElementById("weather").innerHTML=
 `ЁЯМб рждрж╛ржкржорж╛рждрзНрж░рж╛: ${T}┬░C<br>ЁЯТз ржЖрж░рзНржжрзНрж░рждрж╛: ${H}%<br>ЁЯМм ржмрж╛рждрж╛рж╕: ${W} km/h<br>ЁЯМз ржмрзГрж╖рзНржЯрж┐: ${R} mm`;

 document.getElementById("water").innerHTML=
 `ЁЯФе ржмрж╛рж╖рзНржкрзАржнржмржи: ${E.toFixed(2)} mm<br>
 тШБя╕П ржШржирзАржнржмржи: ${C.toFixed(2)} mm<br>
 ЁЯТз ржирзЗржЯ ржкрж╛ржирж┐ ржХрзНрж╖рждрж┐: ${net.toFixed(2)} mm<br>
 ЁЯМН ржорж╛ржЯрж┐рж░ ржкрж╛ржирж┐: ${soil.toFixed(0)}%`;

 let msg="";
 if(soil<40) msg="ЁЯФ┤ ржЖржЬ 45 ржорж┐ржирж┐ржЯ рж╕рзЗржЪ ржжрж┐ржи";
 else if(soil<60) msg="ЁЯЯб 25 ржорж┐ржирж┐ржЯ рж╕рзЗржЪ ржжрж┐ржи";
 else msg="ЁЯЯв ржЖржЬ рж╕рзЗржЪ ржжрж░ржХрж╛рж░ ржирзЗржЗ";

 document.getElementById("decision").innerHTML=
 `<span class="big">${msg}</span>`;

 let p="";
 for(let i=0;i<7;i++){
  let rain=d.daily.precipitation_sum[i];
  let temp=d.daily.temperature_2m_max[i];
  if(rain>5) p+="ржжрж┐ржи "+(i+1)+": ржмрзГрж╖рзНржЯрж┐ тАУ рж╕рзЗржЪ ржмржирзНржз<br>";
  else if(temp>33) p+="ржжрж┐ржи "+(i+1)+": ржЧрж░ржо тАУ рж╕рзЗржЪ ржжрж┐ржи<br>";
  else p+="ржжрж┐ржи "+(i+1)+": рж╣рж╛рж▓ржХрж╛ рж╕рзЗржЪ<br>";
 }
 document.getElementById("plan").innerHTML="ЁЯУЕ рзн ржжрж┐ржирзЗрж░ рж╕рзЗржЪ ржкрж░рж┐ржХрж▓рзНржкржирж╛<br>"+p;
 });
});
</script>

</body>
</html>
